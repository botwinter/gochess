<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>GoChess</title>
    <link rel="stylesheet" href="css/chessboard-0.3.0.min.css">
</head>
<body style="">
<div id="board" style="width: 400px"></div>
<button id="btn1">Start</button>
<script src="js/json3.min.js"></script>
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/chessboard-0.3.0.min.js"></script>
<script>
    var init = function() {        
        var ws = new WebSocket("ws://" + document.location.host + "/ws");
        ws.onmessage = function (evt) {
            console.log(evt.data);
            dataSplit = evt.data.split(" ")
            move = dataSplit[1] + "-" + dataSplit[2]
            console.log(move)
            board.move(move)
        };

        var onDrop = function(source, target, piece, newPos, oldPos, orientation) {
            msg = "player_move " + source + " " + target
            console.log(msg)
            ws.send(msg)
        };

        boardCfg = {
            draggable: true,
            position: 'start',
            onDrop: onDrop,
            sparePieces: false
        };

        var board = ChessBoard('board', boardCfg);

        document.getElementById("btn1").onclick = function () {
            board = ChessBoard('board', boardCfg);
            ws.send("new");
            return false;
        };
    };
$(document).ready(init);
</script>
</body>
</html>